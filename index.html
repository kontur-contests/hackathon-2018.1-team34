
<!doctype html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>Phaser Example Runner</title>
    <meta name="viewport" content="initial-scale=1 maximum-scale=1 user-scalable=0 minimal-ui" />
    <script src="_site/js/jquery-2.0.3.min.js" type="text/javascript"></script>
    <script src="_site/phaser/phaser.js" type="text/javascript"></script>
    <script src="_site/phaser/blob.js" type="text/javascript"></script>
    <script src="_site/phaser/canvas-to-blob.js" type="text/javascript"></script>
    <script src="_site/phaser/filesaver.js" type="text/javascript"></script>
    <script src="_site/phaser/embed.js" type="text/javascript"></script>
    <style>
        body {
            margin: 0px;
            padding: 0px;
            font-family: Arial;
            font-size: 14px;
            background-color: #000000;
            color: #fff;
        }
    </style>
</head>
<body>
<div id="phaser-example"></div>

<script type="text/javascript">

    var IDE_HOOK = false;
    var VERSION = '2.7.7';

    (function () {

        var gameWidth = 800;
        var gameHeight = 600;

        var game = new Phaser.Game(gameWidth, gameHeight, Phaser.AUTO, 'phaser-example', {
            preload: preload,
            create: create,
            update: update,
            render: render
        });

        function preload() {
            game.load.image('bullet', 'assets/games/invaders/bullet.png');
            game.load.image('enemyBullet', 'assets/games/invaders/invader32x32x4.png');
            game.load.spritesheet('invader', 'assets/games/invaders/invader32x32x4.png', 32, 32);
            game.load.image('ship', 'assets/games/invaders/player.png');
            game.load.spritesheet('kaboom', 'assets/games/invaders/explode.png', 128, 128);
            game.load.image('starfield', 'assets/games/invaders/starfield.png');
            game.load.image('background', 'assets/games/starstruck/background2.png');
        }

        var road = {
            x: gameWidth / 2,
            width: 600,
            minWidth: 300,
            maxWidth: 600
        };

        var playerSpeed = 420;

        var player;
        var aliens;
        var bullets;
        var bulletTime = 0;
        var cursors;
        var fireButton;
        var explosions;
        var starfield;
        var score = 0;
        var scoreString = '';
        var scoreText;
        var lives;
        var twoObjects;
        var firingTimer = 0;
        var stateText;
        var livingEnemies = [];

        function create() {

            game.physics.startSystem(Phaser.Physics.ARCADE);

            //  The scrolling starfield background
            starfield = game.add.tileSprite(0, 0, 800, 600, 'starfield');

            //  Our bullet group
            bullets = game.add.group();
            bullets.enableBody = true;
            bullets.physicsBodyType = Phaser.Physics.ARCADE;
            bullets.createMultiple(30, 'bullet');
            bullets.setAll('anchor.x', 0.5);
            bullets.setAll('anchor.y', 1);
            bullets.setAll('outOfBoundsKill', true);
            bullets.setAll('checkWorldBounds', true);

            // The enemy's bullets
            fallingObjects = game.add.group();
            fallingObjects.enableBody = true;
            fallingObjects.physicsBodyType = Phaser.Physics.ARCADE;
            fallingObjects.createMultiple(30, 'enemyBullet');
            fallingObjects.setAll('anchor.x', 0.5);
            fallingObjects.setAll('anchor.y', 1);
            fallingObjects.setAll('outOfBoundsKill', true);
            fallingObjects.setAll('checkWorldBounds', true);

            player = game.add.sprite(400, 500, 'ship');
            player.anchor.setTo(0.5, 0.5);
            game.physics.enable(player, Phaser.Physics.ARCADE);

            scoreString = 'Score : ';
            scoreText = game.add.text(10, 10, scoreString + score, { font: '34px Arial', fill: '#fff' });

            lives = game.add.group();
            game.add.text(game.world.width - 100, 10, 'Lives : ', { font: '34px Arial', fill: '#fff' });

            stateText = game.add.text(game.world.centerX,game.world.centerY,' ', { font: '84px Arial', fill: '#fff' });
            stateText.anchor.setTo(0.5, 0.5);
            stateText.visible = false;

            for (var i = 0; i < 3; i++)
            {
                var ship = lives.create(game.world.width - 100 + (30 * i), 60, 'ship');
                ship.anchor.setTo(0.5, 0.5);
                ship.angle = 90;
                ship.alpha = 0.4;
            }

            cursors = game.input.keyboard.createCursorKeys();
            fireButton = game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR);

        }

        function update() {

            starfield.tilePosition.y += 2;

            if (player.alive)
            {
                player.body.velocity.setTo(0, 0);

                if (cursors.left.isDown)
                {
                    player.body.velocity.x = -200;
                }
                else if (cursors.right.isDown)
                {
                    player.body.velocity.x = 200;
                }

                if (game.time.now > firingTimer)
                {
                    enemyFires();
                }

                game.physics.arcade.overlap(fallingObjects, player, enemyHitsPlayer, null, this);
            }

        }

        function render() {
        }

        function enemyHitsPlayer (player,bullet) {

            bullet.kill();

            live = lives.getFirstAlive();

            if (live)
            {
                live.kill();
            }

            if (lives.countLiving() < 1)
            {
                player.kill();
                fallingObjects.callAll('kill');

                stateText.text=" GAME OVER \n Click to restart";
                stateText.visible = true;

                game.input.onTap.addOnce(restart,this);
            }

        }

        function enemyFires () {
            var twoObjects = fallingObjects.getAll('exists', false);
            var left = twoObjects[0];
            var right = twoObjects[1];

            playerSpeed += game.rnd.integerInRange(-50, 50);
            playerSpeed = Math.min(road.width, 1000);
            playerSpeed = Math.max(road.width, 100);

            road.width += game.rnd.integerInRange(-50, 50);

            road.width = Math.min(road.width, road.maxWidth);
            road.width = Math.max(road.width, road.minWidth);

            road.x += game.rnd.integerInRange(-50, 50);
            road.x = Math.min(road.x, gameWidth - road.width / 2);
            road.x = Math.max(road.x, road.width / 2);

            if (left) {
                var leftX = road.x - road.width / 2;
                left.reset(leftX, 0);
                game.physics.arcade.moveToXY(left, leftX, gameHeight, playerSpeed);
            }

            if (right) {
                var rightX = road.x + road.width / 2;
                right.reset(rightX, 0);
                game.physics.arcade.moveToXY(right, rightX, gameHeight, playerSpeed);
            }

            fallingObjects.forEachAlive(function (obj) {
                obj.body.velocity.y = playerSpeed;
            });

            firingTimer = game.time.now + 60000 / playerSpeed;
        }

        function restart () {

            lives.callAll('revive');
            aliens.removeAll();

            player.revive();
            stateText.visible = false;

        }
    })();


</script>

</body>
</html>
